<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Guide de D√©pannage ‚Äî Cam√©ra (Assistant guid√©)</title>
<style>
  :root{
    --bg:#1e293b; --card:#0b1220; --fg:#e5e7eb; --muted:#9ca3af; --accent:#60a5fa;
    --ok:#22c55e; --ko:#ef4444; --warn:#f59e0b; --line:#374151; --chip:#1f2937;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;scroll-padding-top:20px}
  main{padding:12px 12px 96px; max-width:760px; margin:0 auto;}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .status-dot{width:12px;height:12px;border-radius:999px;display:inline-block;background:var(--chip);border:1px solid var(--line)}
  .dot-ok{background:var(--ok);border-color:var(--ok)} .dot-ko{background:var(--ko);border-color:var(--ko)} .dot-warn{background:var(--warn);border-color:var(--warn)}
  button,.btn{appearance:none;border:1px solid var(--line);background:#0b1220;color:var(--fg);padding:12px 14px;border-radius:12px;font-weight:600;font-size:16px;cursor:pointer;width:100%;text-align:center}
  button:active{transform:scale(.98)}
  .pill{flex:1;text-align:center;font-size:14px;padding:8px 10px}
  .sticky-bar{position:fixed;bottom:10px;left:50%;right:auto;transform:translateX(-50%);width:min(100% - 20px, 760px);display:flex;gap:8px;background:rgba(2,6,23,.8);backdrop-filter:blur(6px);padding:10px;border:1px solid var(--line);border-radius:14px;z-index:60}
  #wizard-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(8px);z-index:100;display:none;align-items:center;justify-content:center;padding:16px}
  #wizard-card{width:100%;max-width:460px;background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;animation:fadein .2s ease}
  #wizard-card h3{margin:0 0 10px;font-size:20px;color:var(--accent)}
  #wizard-card p{margin:6px 0 16px;color:var(--fg);font-size:16px;min-height:40px}
  #wizard-answers{display:flex;flex-direction:column;gap:10px}
  #wizard-close{position:absolute;top:12px;right:12px}
  .wizard-tip{background:var(--chip);border-left:3px solid var(--accent);padding:10px;font-size:14px;margin:14px 0 0;border-radius:6px;color:var(--muted)}
  @keyframes fadein{from{opacity:0;transform:scale(.98)}}
  .sticky-bar { display:none; }

</style>
</head>
<body>
<main>
  <div class="card" id="step-alim">
    <h2><span class="status-dot" id="status-alim"></span>1) Alimentation</h2>
    <p style="color:var(--muted);margin:0 0 12px">But: confirmer si la cam√©ra est bien aliment√©e. (AC/PoE/Solaire)</p>
    <button id="startAlimDiag">üîé Assistant guid√© Alimentation</button>
  </div>

  <div class="card" id="step-reseau">
    <h2><span class="status-dot" id="status-reseau"></span>2) R√©seau</h2>
    <p style="color:var(--muted);margin:0 0 12px">But: v√©rifier la communication minimale (tests simples).</p>
    <button id="startNetDiag">üîé Assistant guid√© R√©seau</button>
  </div>

  <div class="card" id="step-materiel">
    <h2><span class="status-dot" id="status-materiel"></span>3) Cam√©ra / Mat√©riel</h2>
    <p style="color:var(--muted);margin:0 0 12px">But: √©carter une panne interne ou une mauvaise conf.</p>
    <button id="startHwDiag">üîé Assistant guid√© Cam√©ra</button>
  </div>
</main>

<nav class="sticky-bar">
  <button class="pill" data-go="#step-alim">Alim</button>
  <button class="pill" data-go="#step-reseau">R√©seau</button>
  <button class="pill" data-go="#step-materiel">Cam√©ra</button>
</nav>

<div aria-live="polite" id="wizard-overlay">
  <div id="wizard-card">
    <button class="pill" id="wizard-close">Fermer ‚úï</button>
    <h3 id="wizard-title">Diagnostic guid√©</h3>
    <p id="wizard-text">‚Ä¶</p>
    <div id="wizard-answers"></div>
    <div id="wizard-tip-container"></div>
  </div>
</div>

<script>
const qs = (s,r=document)=>r.querySelector(s); const qsa=(s,r=document)=>[...r.querySelectorAll(s)];
function setStatus(step, status){ const dot=qs(`#status-${step}`); if(!dot) return; dot.className='status-dot'; if(status) dot.classList.add(`dot-${status}`); }
qsa('[data-go]').forEach(b=>b.addEventListener('click',()=>{ const t=qs(b.getAttribute('data-go')); if(t) t.scrollIntoView({behavior:'smooth',block:'start'}); }));

const flows = {
  alim_main:{
    start:{ title:'Alimentation', text:'Type d\'alimentation ?', answers:[
      {text:'Secteur (230V) / Transfo', flow:'alim_230', next:'start'},
      {text:'PoE (Switch/Injecteur)', flow:'alim_poe', next:'start'},
      {text:'Solaire / Batterie', flow:'alim_solar', next:'start'}
    ]}
  },
  alim_230:{
    start:{ text:'Disjoncteur enclench√© et stable ?', answers:[
      {text:'Oui', next:'transfo_led'},
      {text:'Non', conclusion:{status:'KO', message:'R√©armer. S\'il retombe ‚Üí CC/surcharge.'}}
    ]},
    transfo_led:{ text:'Transfo 12/24 V : LED/allum√©, ti√®de ?', answers:[
      {text:'Oui', next:'mesure_sortie'},
      {text:'Non', conclusion:{status:'KO', message:'Transfo HS ou non aliment√©.'}}
    ]},
    mesure_sortie:{ text:'Mesure sortie transfo conforme (12/24 V, polarit√© OK) ?', answers:[
      {text:'Oui', next:'mesure_cam'},
      {text:'Non', conclusion:{status:'KO', message:'Sortie hors spec ‚Üí remplacer.'}}
    ]},
    mesure_cam:{ text:'Tension aux bornes de la cam√©ra toujours OK ?', answers:[
      {text:'Oui', conclusion:{status:'OK', message:'Alim OK jusqu\'√† la cam√©ra.'}},
      {text:'Non', conclusion:{status:'KO', message:'Chute de tension ‚Üí c√¢ble/connectique.'}}
    ]}
  },
  alim_poe:{
    start:{ text:'LED LINK & PoE sur le port ?', answers:[
      {text:'Oui, fixes', conclusion:{status:'OK', message:'Injection OK. Passer au r√©seau.'}},
      {text:'Non/clignote', next:'essai_cable_court'}
    ]},
    essai_cable_court:{ text:'Essai c√¢ble court et/ou autre port ?', answers:[
      {text:'Oui ‚Üí √ßa marche', conclusion:{status:'WARN', message:'C√¢ble principal/longueur/sertissage en cause.'}},
      {text:'Toujours KO', conclusion:{status:'KO', message:'N√©gociation PoE √©choue ou cam√©ra en d√©faut.'}}
    ]}
  },
  alim_solar:{
    start:{ text:'Batterie ‚â• 12.2 V (12 V) / ‚â• 24.4 V (24 V) ?', answers:[
      {text:'Oui', next:'panneaux'},
      {text:'Non', conclusion:{status:'KO', message:'Batterie faible/LVD.'}}
    ]},
    panneaux:{ text:'Plein soleil : 18‚Äì22 V (12 V) / 36‚Äì44 V (24 V) ?', answers:[
      {text:'Oui', next:'regul'},
      {text:'Non', conclusion:{status:'KO', message:'Panneaux sales/ombrage/c√¢blage/fusible.'}}
    ]},
    regul:{ text:'R√©gulateur OK (voyants charge, sortie active) ?', answers:[
      {text:'Oui', conclusion:{status:'OK', message:'Cha√Æne solaire OK.'}},
      {text:'Non', conclusion:{status:'KO', message:'R√©gulateur d√©fectueux/mauvais c√¢blage.'}}
    ]}
  },
  net:{
    start:{ title:'R√©seau', text:'LED de lien allum√©e ?', answers:[
      {text:'Oui', next:'ping_cam'},
      {text:'Non', conclusion:{status:'KO', message:'Pas de lien. V√©rifier c√¢ble/port.'}}
    ]},
    ping_cam:{ text:'La cam√©ra r√©pond au ping depuis un PC du m√™me r√©seau ?', answers:[
      {text:'Oui', next:'ping_gw'},
      {text:'Non', next:'conflit'}
    ]},
    conflit:{ text:'D√©brancher la cam√©ra puis re‚Äëping l\'IP. R√©ponse ?', answers:[
      {text:'Oui', conclusion:{status:'KO', message:'Conflit d\'IP confirm√©. Changer IP.'}},
      {text:'Non', conclusion:{status:'WARN', message:'Pas de conflit. Essayer l\'acc√®s Web.'}}
    ]},
    ping_gw:{ text:'Ping passerelle OK ?', answers:[
      {text:'Oui', conclusion:{status:'OK', message:'Connectivit√© locale OK.'}},
      {text:'Non', conclusion:{status:'KO', message:'Routage local/port/c√¢ble.'}}
    ]}
  },
  hw:{
    start:{ title:'Cam√©ra', text:'Acc√®s Web (http/https://IP) ?', answers:[
      {text:'Oui', next:'flux'},
      {text:'Non', next:'reboot'}
    ]},
    reboot:{ text:'Reboot √©lectrique tent√© ?', answers:[
      {text:'Oui, toujours KO', next:'test_local'},
      {text:'Apr√®s reboot c\'est OK', conclusion:{status:'OK', message:'Plantage ponctuel. √Ä surveiller.'}}
    ]},
    test_local:{ text:'Essai sur banc local (c√¢ble court/switch test) ?', answers:[
      {text:'OK en local', conclusion:{status:'OK', message:'Cam OK ‚Üí infra site en cause.'}},
      {text:'Toujours KO', next:'reset'}
    ]},
    reset:{ text:'Reset usine effectu√© ?', answers:[
      {text:'Oui, toujours KO', conclusion:{status:'KO', message:'Panne mat√©rielle probable ‚Üí RMA.'}},
      {text:'Pas encore', conclusion:{status:'WARN', message:'Reset + config minimale (IP/utilisateur/flux).'}}
    ]},
    flux:{ text:'Flux vid√©o visible ?', answers:[
      {text:'Oui', conclusion:{status:'OK', message:'Cam√©ra op√©rationnelle.'}},
      {text:'Non', conclusion:{status:'WARN', message:'Service vid√©o/firmware possiblement en cause.'}}
    ]}
  }
};

const overlay=qs('#wizard-overlay'); const title=qs('#wizard-title'); const text=qs('#wizard-text'); const answers=qs('#wizard-answers'); const tipC=qs('#wizard-tip-container');
let currentFlowKey=null, currentFlow=null;
function openWizard(flowKey){ currentFlowKey=flowKey; currentFlow=flows[flowKey]; if(!currentFlow) return; overlay.style.display='flex'; render('start'); }
function render(step){ const s=currentFlow[step]; if(!s) return; title.textContent=s.title||currentFlow.start?.title||'Diagnostic'; text.textContent=s.text||''; answers.innerHTML=''; tipC.innerHTML=s.tip?`<div class="wizard-tip">${s.tip}</div>`:'';
  (s.answers||[]).forEach(a=>{ const b=document.createElement('button'); b.textContent=a.text; b.className='pill'; b.onclick=()=>{ if(a.flow){ currentFlowKey=a.flow; currentFlow=flows[a.flow]; render(a.next); } else if(a.next){ render(a.next); } else if(a.conclusion){ conclude(a.conclusion); } }; answers.appendChild(b); });
  if(s.conclusion) conclude(s.conclusion);
}
function conclude(c){ const map={alim:'alim', net:'reseau', hw:'materiel'}; const key = map[currentFlowKey?.split('_')[0]] || currentFlowKey; setStatus(key, (c.status||'').toLowerCase()); title.textContent=`Conclusion [${c.status}]`; text.textContent=c.message||''; answers.innerHTML=''; tipC.innerHTML=''; const b=document.createElement('button'); b.textContent='Terminer'; b.className='pill'; b.onclick=closeWizard; answers.appendChild(b); }
function closeWizard(){ overlay.style.display='none'; }
document.addEventListener('click',e=>{ if(e.target.id==='startAlimDiag') openWizard('alim_main'); if(e.target.id==='startNetDiag') openWizard('net'); if(e.target.id==='startHwDiag') openWizard('hw'); });
qsa('[data-go]').forEach(b=>b.addEventListener('click',()=>{ const t=qs(b.getAttribute('data-go')); if(t) t.scrollIntoView({behavior:'smooth',block:'start'}); }));
</script>
</body>
</html>
